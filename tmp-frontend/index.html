<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>2242 Online Temporary Frontend</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  </head>
  <body>
    <p class="ms">
      ghj
    </p>
    <button class="btn">
      Send cmd request
    </button>
  </body>
  <script>

   let keys = {
       id: false,
       A: false,
       W: false,
       D: false,
       S: false,
       ce: false, // space
       Q: false
   }

   $(document).ready(function() {
       $(document).on("keydown", event => {
           let key = event.code.slice(3, (event.code.length))
           if (keys.hasOwnProperty(key)) {
               keys[key] = true
           }
       });

       $(document).on("keyup", event => {
           let key = event.code.slice(3, (event.code.length))
           if (keys.hasOwnProperty(key)) {
               keys[key] = false;
           }
       });
   });

   let authSent = false;

   function auth() {
       $(document).on("keyup", event => {
           if (event.code.slice(3, event.code.length) == "U") {
               axios.get("/auth").then(res => {
                   keys.id = res.data.id
                   authSent = true;
                   if (keys.id == 0 || keys.id == 1) {
                       loop()
                   }
               }).catch(err => {console.log(err)});
           }
       })

   }

   function loop() {
       setTimeout(() => {
           keys.ping = Date.now()
           axios.post("/cmd", keys)
                           .then(res => {
                               console.log(res.data[0][1] + "--" +  res.data[0][2])
                               console.log(res.data[1][1] + "--" + res.data[1][2])
                           })

           if (keys.ce) return;
           loop()
       }, 20)
   }
   auth()





  </script>
</html>
